
@extends('admin.layouts.admin')

@section('css')
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css">
@endsection

@section('content')
<div class="card mt-4">
    <div class="card-header bg-primary text-white">
        <h6>Orders List</h6>
    </div>
    <div class="card-body">
        @if (session('success'))
            <div class="alert alert-success">
                {{ session('success') }}
            </div>
        @endif
       

        <table id="orders-table" class="table table-bordered mt-4">
            <thead>
                <tr>
                    <th>Order ID</th>
                    <th>Order Date</th>
                    <th>Status</th>
                    <th>Total Price</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach($orders as $order)
                <tr>
                    <td>{{ '#'.$order->id }}</td>
                    <td>{{ date('Y-m-d', strtotime($order->created_at)) }}</td>
                    <td>{{ ucfirst($order->payment_method) }}</td>
                    <td>
                        <select class="form-select status-select" data-id="{{ $order->id }}">
                            <option value="pending" {{ $order->status == 'pending' ? 'selected' : '' }}>Pending</option>
                            <option value="processing" {{ $order->status == 'processing' ? 'selected' : '' }}>Processing</option>
                            <option value="shipped" {{ $order->status == 'shipped' ? 'selected' : '' }}>Shipped</option>
                            <option value="delivered" {{ $order->status == 'delivered' ? 'selected' : '' }}>Delivered</option>
                            <option value="cancelled" {{ $order->status == 'cancelled' ? 'selected' : '' }}>Cancelled</option>
                        </select>
                    </td>
                    <td>{{ number_format($order->total_amount, 2) }}</td>
                    <td>
                        <a href="{{ route('admin.orders.show', $order->id) }}" class="btn btn-sm btn-primary">View</a>
                    </td>
                </tr>
                @endforeach
            </tbody>
        </table>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    // Initialize DataTable first
   // $('#orders-table').DataTable();

    // Use delegated event listener for dynamically loaded elements
    $(document).on('change', '.status-select', function() {
        let orderId = $(this).data('id');
        let status = $(this).val();

        $.ajax({
            url: "{{ route('admin.orders.updateStatus') }}",
            type: "POST",
            data: {
                _token: "{{ csrf_token() }}",
                order_id: orderId,
                status: status
            },
            success: function(response) {
                if (response.success) {
                    alert('Order status updated successfully!');
                } else {
                    alert('Failed to update status');
                }
            },
            error: function() {
                alert('Something went wrong!');
            }
        });
    });
});
</script>
@endsection
